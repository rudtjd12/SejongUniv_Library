<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>좌석 상태 데모</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            min-height: 100vh;
            align-items: center;
            justify-content: center;
            background: #f5f5f5;
        }
        .card {
            background: #ffffff;
            padding: 24px 28px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            text-align: center;
            max-width: 360px;
            width: 100%;
        }
        .seat-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 12px;
        }
        .status {
            font-size: 18px;
            margin: 16px 0;
        }
        .status span {
            font-weight: 700;
        }
        .status-enter { color: #2e7d32; }
        .status-out { color: #f9a825; }
        .status-leave { color: #c62828; }

        .student-line {
            font-size: 16px;
            margin-top: 4px;
            border-top: 1px solid #ddd;
            padding-top: 8px;
        }
        .student-line span {
            font-weight: 600;
        }

        .btn-row {
            display: flex;
            gap: 8px;
            justify-content: center;
            flex-wrap: wrap;
        }
        button {
            padding: 8px 14px;
            font-size: 15px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
        }
        .btn-primary { background: #1976d2; color: #fff; }
        .btn-secondary { background: #eeeeee; }

        #idInput {
            width: 100%;
            padding: 8px 10px;
            font-size: 16px;
            margin-bottom: 12px;
            border-radius: 8px;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }

        .info {
            margin-top: 10px;
            font-size: 11px;
            color: #666;
        }

        .error {
            color: #c62828;
            font-size: 14px;
            margin-top: 8px;
        }
    </style>
</head>
<body>

<!-- 1) 학번 입력 화면 -->
<div class="card" id="id-card">
    <div id="seat-title-form" class="seat-title">좌석 정보 불러오는 중...</div>

    <input id="idInput" type="text" placeholder="학번을 입력하세요" />
    <button id="idSubmit" class="btn-primary">확인</button>

    <div id="idError" class="error" style="display:none;"></div>

    <div class="info">이 학번과 좌석 상태는 이 기기(브라우저)에만 저장됩니다.</div>
</div>

<!-- 2) 좌석 화면 -->
<div class="card" id="seat-card" style="display:none;">
    <div id="seat-title" class="seat-title"></div>

    <div id="student-line" class="student-line">
        학번: <span id="student-id-text">-</span>
    </div>

    <div id="status" class="status">상태: <span>미설정</span></div>

    <div class="btn-row">
        <button class="btn-secondary" data-status="입실">입실</button>
        <button class="btn-secondary" data-status="외출">외출</button>
        <button class="btn-secondary" data-status="퇴실">퇴실</button>
    </div>

    <div class="info">좌석/학번/상태는 이 기기에서만 기억됩니다.</div>
</div>

<script>
    const params = new URLSearchParams(window.location.search);
    const seat = params.get("seat");

    const idCard = document.getElementById("id-card");
    const seatCard = document.getElementById("seat-card");

    const seatTitleFormEl = document.getElementById("seat-title-form");
    const seatTitleEl = document.getElementById("seat-title");
    const studentIdTextEl = document.getElementById("student-id-text");
    const statusEl = document.getElementById("status").querySelector("span");

    const idInputEl = document.getElementById("idInput");
    const idSubmitBtn = document.getElementById("idSubmit");
    const idErrorEl = document.getElementById("idError");

    if (!seat) {
        seatTitleFormEl.textContent = "좌석 정보가 없습니다";
        idErrorEl.style.display = "block";
        idErrorEl.textContent = "URL에 ?seat=번호 가 필요합니다.";
        idSubmitBtn.disabled = true;
    } else {
        const seatLabel = seat + "번 좌석";

        seatTitleFormEl.textContent = seatLabel;
        seatTitleEl.textContent = seatLabel;

        const idKey = "seat_" + seat + "_studentId";
        const statusKey = "seat_" + seat + "_status";

        let currentId = localStorage.getItem(idKey) || "";
        let currentStatus = localStorage.getItem(statusKey) || "미설정";

        function renderStatus() {
            statusEl.textContent = currentStatus;
            statusEl.classList.remove("status-enter", "status-out", "status-leave");

            if (currentStatus === "입실") statusEl.classList.add("status-enter");
            else if (currentStatus === "외출") statusEl.classList.add("status-out");
            else if (currentStatus === "퇴실") statusEl.classList.add("status-leave");
        }

        function showSeatCard() {
            studentIdTextEl.textContent = currentId || "-";
            renderStatus();
            idCard.style.display = "none";
            seatCard.style.display = "block";
        }

        if (currentId) {
            showSeatCard();
        }

        idSubmitBtn.addEventListener("click", () => {
            const idVal = idInputEl.value.trim();
            if (!idVal) {
                idErrorEl.style.display = "block";
                idErrorEl.textContent = "학번을 입력해주세요.";
                return;
            }
            idErrorEl.style.display = "none";

            currentId = idVal;
            localStorage.setItem(idKey, currentId);

            showSeatCard();
        });

        // ★ 상태 버튼 처리 (퇴실 = 학번 삭제 기능 포함)
        document.querySelectorAll(".btn-row button").forEach(btn => {
            btn.addEventListener("click", () => {
                const s = btn.getAttribute("data-status");

                currentStatus = s;
                localStorage.setItem(statusKey, currentStatus);

                // ★ 퇴실일 때 학번 초기화
                if (s === "퇴실") {
                    currentId = "";
                    localStorage.removeItem(idKey);
                    studentIdTextEl.textContent = "-";
                }

                renderStatus();
            });
        });
    }
</script>

</body>
</html>
