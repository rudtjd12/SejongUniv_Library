<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>ìŠ¤ë§ˆíŠ¸ ì¢Œì„ ë°°ì • ì‹œìŠ¤í…œ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        /* [ìŠ¤íƒ€ì¼ ì •ì˜] */
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            align-items: center;
            justify-content: center;
            
            /* [ìˆ˜ì •] ë°°ê²½ì„ ì›€ì§ì´ëŠ” ê·¸ë¼ë°ì´ì…˜ìœ¼ë¡œ ë³€ê²½ (ê³ ê¸‰ìŠ¤ëŸ¬ì›€ UP) */
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            transition: background 0.5s;
        }

        /* ë°°ê²½ ì›€ì§ì´ëŠ” ì• ë‹ˆë©”ì´ì…˜ ì •ì˜ */
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* ë“±ì¥ ì• ë‹ˆë©”ì´ì…˜ (ì•„ë˜ì—ì„œ ìœ„ë¡œ ìŠ¤ë¥´ë¥µ) */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translate3d(0, 40px, 0);
            }
            to {
                opacity: 1;
                transform: translate3d(0, 0, 0);
            }
        }

        .app-header {
            text-align: center;
            margin-bottom: 24px;
            color: white; /* ë°°ê²½ì´ í™”ë ¤í•˜ë‹ˆ ê¸€ìëŠ” í°ìƒ‰ */
            text-shadow: 0 2px 4px rgba(0,0,0,0.2); /* ê·¸ë¦¼ì */
            animation: fadeInUp 0.8s ease-out; /* ë“±ì¥ íš¨ê³¼ ì ìš© */
        }
        .app-title { font-size: 24px; font-weight: 800; margin: 0; }
        .app-subtitle { font-size: 14px; opacity: 0.9; margin-top: 4px; color: #f0f0f0; }

        .bottom-footer {
            margin-top: 60px;
            text-align: center;
            padding-bottom: 40px;
            width: 100%;
            max-width: 360px;
            animation: fadeInUp 1.2s ease-out; /* ì•½ê°„ ëŠ¦ê²Œ ë“±ì¥ */
        }
        
        .nudge-text {
            font-size: 14px;
            color: white; /* ë‹¤í¬ëª¨ë“œ/ë¼ì´íŠ¸ëª¨ë“œ ìƒê´€ì—†ì´ ì˜ ë³´ì´ê²Œ */     
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
            font-weight: 600; 
            margin-bottom: 12px;
            min-height: 20px; 
            line-height: 1.4;
            padding: 0 10px;
            word-break: break-all;
            transition: opacity 0.3s;
        }

        .bottom-logo-img {
            max-width: 160px;
            height: auto;
            display: block;
            margin: 0 auto;
            opacity: 0.9;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }

        /* [í•µì‹¬] ê¸€ë˜ìŠ¤ëª¨í”¼ì¦˜ ì¹´ë“œ ë””ìì¸ */
        .card {
            background: rgba(255, 255, 255, 0.85); /* ë°˜íˆ¬ëª… í°ìƒ‰ */
            backdrop-filter: blur(12px); /* ë’¤ìª½ ë°°ê²½ íë¦¬ê²Œ (ë¸”ëŸ¬ íš¨ê³¼) */
            -webkit-backdrop-filter: blur(12px); /* ì‚¬íŒŒë¦¬ìš© */
            
            padding: 30px 28px;
            border-radius: 20px; /* ë” ë‘¥ê¸€ê²Œ */
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15); /* ë¶€ë“œëŸ¬ìš´ ê·¸ë¦¼ì */
            border: 1px solid rgba(255, 255, 255, 0.4); /* ì–‡ì€ í…Œë‘ë¦¬ */
            
            text-align: center;
            max-width: 340px;
            width: 90%;
            margin-bottom: auto; 
            animation: fadeInUp 1s ease-out; /* ë“±ì¥ íš¨ê³¼ ì ìš© */
        }
        
        #id-card, #seat-card { margin-top: auto; }

        .seat-title { font-size: 22px; font-weight: 800; margin-bottom: 16px; color: #333; }
        
        .status { font-size: 18px; margin: 16px 0; }
        .status span { font-weight: 700; }
        .status-enter { color: #2e7d32; } 
        .status-out { color: #f57f17; }   
        
        .student-line {
            font-size: 16px; margin-top: 10px; border-top: 1px solid rgba(0,0,0,0.1);
            padding-top: 12px; margin-bottom: 16px;
        }
        .student-line span { font-weight: 700; color: #333; }

        .timer-box {
            background: rgba(255, 235, 238, 0.8); /* ë°˜íˆ¬ëª… */
            color: #c62828; padding: 10px;
            border-radius: 10px; margin-bottom: 15px; font-weight: bold;
            display: none; 
            box-shadow: inset 0 0 5px rgba(0,0,0,0.05);
        }

        .warning-box {
            font-size: 13px; color: #d32f2f; margin-bottom: 10px;
            background: rgba(255, 243, 224, 0.9); padding: 8px; border-radius: 8px;
            display: none;
        }

        .btn-row { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }
        
        button {
            padding: 12px 18px; font-size: 15px; border-radius: 12px;
            border: none; cursor: pointer; transition: transform 0.1s, box-shadow 0.2s;
            font-weight: 700;
        }
        button:active { transform: scale(0.95); } /* ëˆ„ë¥¼ ë•Œ ì‚´ì§ ì‘ì•„ì§ */
        
        .btn-primary { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); /* ë²„íŠ¼ë„ ê·¸ë¼ë°ì´ì…˜ */
            color: #fff; box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .btn-secondary { background: #f0f0f0; color: #333; }
        .btn-danger { 
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            color: #fff; box-shadow: 0 4px 15px rgba(255, 75, 43, 0.3);
        }
        
        .btn-test { background: rgba(0,0,0,0.5); color: #fff; font-size: 11px; margin-top: 20px; }

        #idInput {
            width: 100%; padding: 12px 15px; font-size: 16px; margin-bottom: 16px;
            border-radius: 12px; border: 2px solid #eee; box-sizing: border-box;
            background: rgba(255,255,255,0.9);
            transition: border-color 0.3s;
        }
        #idInput:focus { outline: none; border-color: #764ba2; }

        .info { margin-top: 15px; font-size: 12px; color: #666; opacity: 0.8; }
        .info2 { margin-top: 15px; font-size: 13px; color: #d32f2f; font-weight: 600; }
        .error { color: #ff1744; font-size: 14px; margin-top: 10px; display: none; font-weight: bold; }

        /* ë‹¤í¬ ëª¨ë“œ ìŠ¤íƒ€ì¼ */
        body.dark-mode {
            background: #1a1a2e; /* ë‹¤í¬ëª¨ë“œì¼ ë• ë‹¨ìƒ‰ ë°°ê²½ (ë„ˆë¬´ ëˆˆë¶€ì‹œì§€ ì•Šê²Œ) */
            background-image: none;
            color: #e0e0e0;
        }
        body.dark-mode .card {
            background: rgba(30, 30, 30, 0.8); /* ë°˜íˆ¬ëª… ê²€ì • */
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #e0e0e0;
        }
        body.dark-mode .app-title, body.dark-mode .app-subtitle, body.dark-mode .nudge-text { color: #eee; }
        body.dark-mode #idInput { background: #333; border-color: #555; color: white; }
        body.dark-mode .student-line { border-color: #444; }
        body.dark-mode .student-line span { color: #fff; }
        body.dark-mode .seat-title { color: #fff; }

        /* í…Œë§ˆ ë²„íŠ¼ */
        .theme-btn {
            position: absolute; top: 20px; right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%; width: 44px; height: 44px;
            border: 1px solid rgba(255,255,255,0.3);
            font-size: 20px; cursor: pointer; z-index: 100;
            display: flex; align-items: center; justify-content: center;
            backdrop-filter: blur(5px);
            transition: background 0.3s;
        }
        .theme-btn:hover { background: rgba(255, 255, 255, 0.4); }
        
    </style>
</head>
<body>

    <button id="theme-toggle" class="theme-btn" onclick="toggleTheme()">ğŸŒ™</button>

    <div class="app-header">
        <h1 class="app-title">SEJONG UNIVERSITY</h1>
        <p class="app-subtitle">ìŠ¤ë§ˆíŠ¸ ì¢Œì„ ë°°ì • ì‹œìŠ¤í…œ</p>
    </div>

    <div class="card" id="id-card">
        <div id="seat-title-form" class="seat-title">ì¢Œì„ ì •ë³´ í™•ì¸ ì¤‘...</div>
        
        <input id="idInput" type="text" maxlength="8" inputmode="numeric" placeholder="í•™ë²ˆ 8ìë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”" />
        
        <button id="idSubmit" class="btn-primary" style="width:100%">ì…ì‹¤ í•˜ê¸°</button>
        <div id="idError" class="error"></div>
        <div class="info2">ì„¸ì¢…ëŒ€ìƒ 98%ê°€ ì§€í‚¤ëŠ” ë§¤ë„ˆ,<br>í‡´ì‹¤ ì²˜ë¦¬ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.</div>
    </div>

    <div class="card" id="seat-card" style="display:none;">
        <div id="seat-title" class="seat-title"></div>

        <div class="student-line">
            User: <span id="student-id-text">-</span>
        </div>

        <div id="warning-display" class="warning-box">
            âš ï¸ ëˆ„ì  ê²½ê³ : <span id="warning-count">0</span>íšŒ (3íšŒì‹œ í‡´ì‹¤)
        </div>

        <div id="status" class="status">ìƒíƒœ: <span>ì…ì‹¤ ì¤‘</span></div>

        <div id="out-timer-box" class="timer-box">
            ì™¸ì¶œ ì‹œê°„: <span id="timer-text">00:00:00</span>
            <div style="font-size:11px; font-weight:normal; margin-top:4px; opacity:0.8">
                (3ì‹œê°„ ì´ˆê³¼ ì‹œ ê²½ê³ )
            </div>
        </div>

        <div class="btn-row">
            <div id="controls-in" style="display:block;">
                <button class="btn-secondary" id="btn-go-out">ì™¸ì¶œ í•˜ê¸°</button>
                <button class="btn-danger" id="btn-leave">í‡´ì‹¤</button>
            </div>
            <div id="controls-out" style="display:none;">
                <button class="btn-primary" id="btn-return">ë³µê·€ í•˜ê¸°</button>
                <button class="btn-danger" id="btn-leave-out">ë°”ë¡œ í‡´ì‹¤</button>
            </div>
        </div>

        <button id="btn-test-add-time" class="btn-test" style="display:none;">
            [í…ŒìŠ¤íŠ¸] ì‹œê°„ +3h
        </button>

        <div class="info">í‡´ì‹¤ ì‹œ ì´ˆê¸° í™”ë©´ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.</div>
    </div>

    <div class="bottom-footer">
        <div id="footer-msg" class="nudge-text"></div>
        <img src="Sejong-University.png" alt="Sejong University Logo" class="bottom-logo-img" />
    </div>


<script>
    // ============================================================
    // [ì„¤ì •] ìƒìˆ˜
    // ============================================================
    const WARNING_LIMIT_MS = 3 * 60 * 60 * 1000;
    const BAN_DURATION_MS = 14 * 24 * 60 * 60 * 1000;
    
    // [ì„¤ì •] ë¡¤ë§ ë¬¸êµ¬
    const nudgeMessages = [
        "ì„¸ì¢…ëŒ€ìƒ 95%ëŠ” ì™¸ì¶œ 3ì‹œê°„ ì•½ì†ì„ ì •í™•íˆ ì§€í‚µë‹ˆë‹¤.",
        "ì§€ê¸ˆ ë‹¹ì‹ ì˜ ë°°ë ¤ê°€, ë„ì„œê´€ ë¬¸í™”ë¥¼ ë§Œë“­ë‹ˆë‹¤.",
        "ë¹ˆìë¦¬ëŠ” ì§ì´ ì•„ë‹ˆë¼, ë‹¤ìŒ ì‚¬ëŒì—ê²Œ ì–‘ë³´í•´ ì£¼ì„¸ìš”.",
        "ì§€ë‚œë‹¬, 1,200ëª…ì˜ í•™ìš°ê°€ í‡´ì‹¤ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë°°ë ¤í–ˆìŠµë‹ˆë‹¤.",
        "ì´ ìë¦¬ëŠ” ë‚´ì¼ì˜ ë‹¹ì‹ ì´ ë‹¤ì‹œ ì•‰ê³  ì‹¶ì–´ í•  ìë¦¬ì…ë‹ˆë‹¤.",
        "ì „ì²´ ì´ìš©ì 95%ëŠ” ì™¸ì¶œë²„íŠ¼ì„ ëˆ„ë¦…ë‹ˆë‹¤.",
        "ì™¸ì¶œ, í‡´ì‹¤ ë˜ ê¹Œë¨¹ì—ˆì§€? ì–¼ë¥¸ ëˆŒëŸ¬ì£¼ì„¸ìš”.",
        "ë˜ ê·¸ëƒ¥ ë‚˜ê°€ë ¤ í•˜ì…¨ë‚˜ìš”? í‡´ì‹¤ ë²„íŠ¼ì€ í•„ìˆ˜ì…ë‹ˆë‹¤."
    ];

    // ============================================================
    // [ë¡œì§ 1] ë¡¤ë§ ë¬¸êµ¬
    // ============================================================
    let msgIndex = 0;
    const msgElement = document.getElementById("footer-msg");

    function rotateMessage() {
        if(nudgeMessages.length > 0) {
            msgElement.style.opacity = 0; // í˜ì´ë“œ ì•„ì›ƒ
            setTimeout(() => {
                msgElement.textContent = nudgeMessages[msgIndex];
                msgElement.style.opacity = 1; // í˜ì´ë“œ ì¸
                msgIndex = (msgIndex + 1) % nudgeMessages.length;
            }, 300);
        }
    }
    rotateMessage(); 
    setInterval(rotateMessage, 6000); // 6ì´ˆë§ˆë‹¤ ë³€ê²½


    // ============================================================
    // [ë¡œì§ 2] URL ë° ì¤‘ë³µ ê²€ì‚¬
    // ============================================================
    const params = new URLSearchParams(window.location.search);
    const seatNum = params.get("seat");
    const activeSeat = localStorage.getItem("device_active_seat");

    if (activeSeat && seatNum && activeSeat !== seatNum) {
        alert(`ğŸš« ì˜¤ë¥˜: ì´ë¯¸ ${activeSeat}ë²ˆ ì¢Œì„ì„ ì´ìš© ì¤‘ì…ë‹ˆë‹¤!\n\ní•´ë‹¹ ì¢Œì„ ëŒ€ì‹œë³´ë“œë¡œ ì´ë™í•©ë‹ˆë‹¤.`);
        window.location.href = `?seat=${activeSeat}`;
        throw new Error("Redirecting...");
    }

    // ============================================================
    // [ë¡œì§ 3] DOM ì—°ê²°
    // ============================================================
    const idCard = document.getElementById("id-card");
    const seatCard = document.getElementById("seat-card");
    const idInputEl = document.getElementById("idInput");
    const idErrorEl = document.getElementById("idError");
    const seatTitleFormEl = document.getElementById("seat-title-form");
    const seatTitleEl = document.getElementById("seat-title");
    
    const studentIdTextEl = document.getElementById("student-id-text");
    const warningCountEl = document.getElementById("warning-count");
    const statusTextEl = document.querySelector("#status span");
    const timerBox = document.getElementById("out-timer-box");
    const timerText = document.getElementById("timer-text");
    const warningDisplay = document.getElementById("warning-display");

    const controlsIn = document.getElementById("controls-in");
    const controlsOut = document.getElementById("controls-out");

    let currentId = "";
    let timerInterval = null;

    // ============================================================
    // [ë¡œì§ 4] ì´ˆê¸° ì„¸íŒ…
    // ============================================================
    if (!seatNum) {
        seatTitleFormEl.textContent = "ì¢Œì„ ë²ˆí˜¸ ì˜¤ë¥˜";
        idErrorEl.style.display = "block";
        idErrorEl.textContent = "URLì— ?seat=ë²ˆí˜¸ í˜•ì‹ì´ í•„ìš”í•©ë‹ˆë‹¤.";
        document.getElementById("idSubmit").disabled = true;
    } else {
        seatTitleFormEl.textContent = `${seatNum}ë²ˆ ì¢Œì„`;
        seatTitleEl.textContent = `${seatNum}ë²ˆ ì¢Œì„`;

        const savedId = localStorage.getItem(`seat_${seatNum}_studentId`);
        if (savedId) {
            login(savedId);
        }
    }

    // ============================================================
    // [ë¡œì§ 5] ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
    // ============================================================
    
    // 1. ë¡œê·¸ì¸ (í­ì£½ íš¨ê³¼ ì¶”ê°€!)
    document.getElementById("idSubmit").addEventListener("click", () => {
        const inputId = idInputEl.value.trim();
        
        if (!inputId) { showError("í•™ë²ˆì„ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }
        if (!/^\d{8}$/.test(inputId)) { showError("í•™ë²ˆì€ ìˆ«ì 8ìë¦¬ì—¬ì•¼ í•©ë‹ˆë‹¤."); return; }
        
        const banInfo = getStudentBanInfo(inputId);
        if (banInfo.isBanned) {
            showError(`ì´ìš© ì •ì§€ëœ ì‚¬ìš©ìì…ë‹ˆë‹¤.\ní•´ì œì¼: ${banInfo.date}`);
            return;
        }

        // [WOW í¬ì¸íŠ¸] í­ì£½ í„°íŠ¸ë¦¬ê¸°!
        fireConfetti();

        localStorage.setItem(`seat_${seatNum}_studentId`, inputId);
        localStorage.setItem("device_active_seat", seatNum);
        login(inputId);
    });

    document.getElementById("btn-go-out").addEventListener("click", setOutStatus);

    document.getElementById("btn-return").addEventListener("click", () => {
        checkOutDurationAndProcess(); 
        setInStatus(); 
    });

    document.getElementById("btn-leave").addEventListener("click", () => {
        const userCheck = confirm("í‡´ì‹¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\në¹ˆìë¦¬ëŠ” ë‹¤ìŒ í•™ìš°ì—ê²Œ í° ë„ì›€ì´ ë©ë‹ˆë‹¤.");
        if (userCheck) logout(true);
    });

    document.getElementById("btn-leave-out").addEventListener("click", () => {
        checkOutDurationAndProcess();
        if (currentId) {
            const userCheck = confirm("ì™¸ì¶œ ìƒíƒœì—ì„œ ë°”ë¡œ í‡´ì‹¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
            if (userCheck) logout(true);
        }
    });

    document.getElementById("btn-test-add-time").addEventListener("click", () => {
        const outStartKey = `seat_${seatNum}_outStartTime`;
        let startTime = parseInt(localStorage.getItem(outStartKey));
        if (startTime) {
            const newStartTime = startTime - (3 * 60 * 60 * 1000) - (60 * 1000); 
            localStorage.setItem(outStartKey, newStartTime);
            alert("í…ŒìŠ¤íŠ¸: ì™¸ì¶œ ì‹œê°„ +3ì‹œê°„");
        } else {
            alert("ì™¸ì¶œ ìƒíƒœê°€ ì•„ë‹™ë‹ˆë‹¤.");
        }
    });

    // ============================================================
    // [ê¸°ëŠ¥] ë‹¤í¬ ëª¨ë“œ
    // ============================================================
    const themeBtn = document.getElementById("theme-toggle");
    const currentTheme = localStorage.getItem("theme");
    
    if (currentTheme === "dark") {
        document.body.classList.add("dark-mode");
        themeBtn.textContent = "â˜€ï¸";
    }

    function toggleTheme() {
        document.body.classList.toggle("dark-mode");
        if (document.body.classList.contains("dark-mode")) {
            localStorage.setItem("theme", "dark");
            themeBtn.textContent = "â˜€ï¸";
        } else {
            localStorage.setItem("theme", "light");
            themeBtn.textContent = "ğŸŒ™";
        }
    }

    // ============================================================
    // [ê¸°ëŠ¥] í­ì£½ í•¨ìˆ˜ (Canvas Confetti)
    // ============================================================
    function fireConfetti() {
        var count = 200;
        var defaults = {
            origin: { y: 0.7 }
        };

        function fire(particleRatio, opts) {
            confetti(Object.assign({}, defaults, opts, {
                particleCount: Math.floor(count * particleRatio)
            }));
        }

        fire(0.25, { spread: 26, startVelocity: 55, });
        fire(0.2, { spread: 60, });
        fire(0.35, { spread: 100, decay: 0.91, scalar: 0.8 });
        fire(0.1, { spread: 120, startVelocity: 25, decay: 0.92, scalar: 1.2 });
        fire(0.1, { spread: 120, startVelocity: 45, });
    }


    // ============================================================
    // [í•µì‹¬ í•¨ìˆ˜]
    // ============================================================
    function login(id) {
        currentId = id;
        idInputEl.value = "";
        idErrorEl.style.display = "none";
        
        idCard.style.display = "none";
        seatCard.style.display = "block";
        studentIdTextEl.textContent = currentId;

        updateWarningDisplay();

        const savedStatus = localStorage.getItem(`seat_${seatNum}_status`) || "ì…ì‹¤";
        if (savedStatus === "ì™¸ì¶œ") {
            resumeOutStatus();
        } else {
            setInStatus(false);
        }
    }

    function logout(showAlert = false) {
        localStorage.removeItem(`seat_${seatNum}_studentId`);
        localStorage.removeItem(`seat_${seatNum}_status`);
        localStorage.removeItem(`seat_${seatNum}_outStartTime`);
        localStorage.removeItem("device_active_seat");
        
        if (timerInterval) clearInterval(timerInterval);
        currentId = "";

        seatCard.style.display = "none";
        idCard.style.display = "block";
        
        if (showAlert) alert("í‡´ì‹¤ ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
    }

    function setInStatus(save = true) {
        if(save) localStorage.setItem(`seat_${seatNum}_status`, "ì…ì‹¤");
        localStorage.removeItem(`seat_${seatNum}_outStartTime`);
        
        statusTextEl.textContent = "ì…ì‹¤ ì¤‘";
        statusTextEl.className = "status-enter";
        
        controlsIn.style.display = "block";
        controlsOut.style.display = "none";
        timerBox.style.display = "none";
        
        if (timerInterval) clearInterval(timerInterval);
    }

    function setOutStatus() {
        const now = Date.now();
        localStorage.setItem(`seat_${seatNum}_status`, "ì™¸ì¶œ");
        localStorage.setItem(`seat_${seatNum}_outStartTime`, now);
        resumeOutStatus();
    }

    function resumeOutStatus() {
        statusTextEl.textContent = "ì™¸ì¶œ ì¤‘";
        statusTextEl.className = "status-out";
        controlsIn.style.display = "none";
        controlsOut.style.display = "block";
        timerBox.style.display = "block";
        
        if (timerInterval) clearInterval(timerInterval);
        timerInterval = setInterval(updateTimer, 1000);
        updateTimer();
    }

    function updateTimer() {
        const startTime = parseInt(localStorage.getItem(`seat_${seatNum}_outStartTime`));
        if (!startTime) return;

        const now = Date.now();
        const diff = now - startTime;
        
        const hours = Math.floor(diff / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diff % (1000 * 60)) / 1000);
        const fmt = (n) => n.toString().padStart(2, '0');
        
        timerText.textContent = `${fmt(hours)}:${fmt(minutes)}:${fmt(seconds)}`;
        
        if (diff > WARNING_LIMIT_MS) {
            timerText.style.color = "red";
            timerText.style.fontWeight = "900";
        } else {
            timerText.style.color = "#c62828";
        }
    }

    function checkOutDurationAndProcess() {
        const startTime = parseInt(localStorage.getItem(`seat_${seatNum}_outStartTime`));
        if (!startTime) return;

        const diff = Date.now() - startTime;
        if (diff > WARNING_LIMIT_MS) {
            addWarning(currentId);
        }
    }

    function getStudentBanInfo(id) {
        const banDateStr = localStorage.getItem(`student_${id}_banDate`);
        if (banDateStr) {
            const banDate = new Date(parseInt(banDateStr));
            if (new Date() < banDate) {
                return { isBanned: true, date: banDate.toLocaleDateString() };
            } else {
                localStorage.removeItem(`student_${id}_banDate`);
                localStorage.removeItem(`student_${id}_warnings`);
            }
        }
        return { isBanned: false };
    }

    function addWarning(id) {
        let warnings = parseInt(localStorage.getItem(`student_${id}_warnings`) || "0");
        warnings++;
        localStorage.setItem(`student_${id}_warnings`, warnings);

        if (warnings >= 3) {
            const banEndDate = Date.now() + BAN_DURATION_MS;
            localStorage.setItem(`student_${id}_banDate`, banEndDate);
            alert(`ğŸš¨ ê²½ê³  3íšŒ ëˆ„ì !\nê·œì •ì— ë”°ë¼ 2ì£¼ê°„ ì´ìš©ì´ ì •ì§€ë©ë‹ˆë‹¤.`);
            logout(false);
        } else {
            alert(`[ê²½ê³  ì•Œë¦¼] ì™¸ì¶œ 3ì‹œê°„ ì´ˆê³¼.\ní˜„ì¬ ëˆ„ì  ê²½ê³ : ${warnings}íšŒ`);
            updateWarningDisplay();
        }
    }

    function updateWarningDisplay() {
        const warnings = localStorage.getItem(`student_${currentId}_warnings`) || "0";
        warningCountEl.textContent = warnings;
        warningDisplay.style.display = "block";
    }

    function showError(msg) {
        idErrorEl.textContent = msg;
        idErrorEl.style.display = "block";
    }

</script>
</body>
</html>
